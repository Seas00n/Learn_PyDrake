# 动力学数值计算中的编程规范

[TOC]



## 误差

Accuracy: 容许的最大相对误差`rtol`

Tolerance: 容许的最大绝对误差`tol`

```python
rtol = 1e-3 # 三位有效数字e.g. 1.24 or 0.00124
tol = 1e-3 # 绝对误差不超过0.001mm
# 一般使用用户设定的准确度来计算某个数值的绝对误差
# unit_是value相同量纲的单位值
tol = rtol*max(unit_,abs(value)

```

## 物理符号基础

首先需要知道代码中不会出现矢量符号，只会出现其对应坐标的符号

物理符号有以下部分组成

1. 属性符号（v：速度，I：惯量）
2. 参考符号（相对于谁测量 measured in who）
3. 目标符号（力作用于哪个点，哪个刚体的旋量，向量指向谁）
4. 序号（在集合中的索引）
5. 坐标系符号（在哪个坐标系下表示）

$^{R}Q_i^{T}$表示相对于R，指向T的第i个Q

$[^{R}Q_i^{T}]_{F}$表示相对于R，指向T的第i个Q在F下的**坐标**（Qi_RT_F in code）

e.g. 刚体B相对于A的角速度在世界坐标系下的表示是$[^{A}w^{B}]_{W}$ (w_AB_W in code)，刚体B相对于A的角速度在A坐标系下的表示是$[^{A}w^{B}]_{A}$，缩写为$[^{A}w^{B}]$(w_AB in code)因为{A}是相对速度的默认坐标系

世界坐标系被表示为W，固定于世界坐标系的牛顿坐标系统一为$W_N$

对于一个刚体，drake内部将其抽象为相关数据。用户通过指定位姿的方式给出刚体固结坐标系的位置，其原点为Bo，基向量在为Bx，By，Bz中。由于下标太长不方便编写代码，一般会将Bo缩写为B，这样B就有了三重含义，注意结合上下文区分

1. 刚体B
2. 固结坐标系B
3. 固结坐标系原点B

刚体固结坐标系的选取和刚体的实际形状，质量分布等没有关系。在urdf文件中定义的几何质量等属性被转换到刚体坐标系B下，同时质心Bcm被计算并通过$[^{Bcm}p^{B}]_{B}$表示。刚体的位置，旋量等运动学属性也是被默认表示在固结坐标系下的，这就是为什么最右下角的Frame B常常被省略。

对于某个坐标系F，如果有一个原点在Q的偏置坐标系随着其一起移动，该偏置坐标系记为$F_{Q}$(in code Fq)。显然，FQ相对于F的旋量为0，$[^{F}V^{F_{Q}}]_{F}=0$。在给出Q在F下的坐标系后默认FQ的朝向和F一致，如果不一致需要用户在代码中设置。

对刚体固结坐标系来说B~Q~表示刚体上某个点随着刚体运动瞬间扫过某个点Q。同上所述，在该点的坐标系也记为B~Q~。

e.g. $^{A}V^{B_{Q}}$表示瞬间扫过Q的瞬时坐标系B~Q~相对于A的旋量（非坐标）

[更多详细的物理学符号见文档表格](https://drake.mit.edu/doxygen_cxx/group__multibody__quantities.html)

## 数值微分符号

标量一阶导，二阶导：xDt，xDDt in code

向量对时间的导数不是单纯的坐标求导，需要考虑表示坐标系的导数

e.g.  $v$ 被分解在G坐标系下（measured in G），通过坐标系的导数表示其旋转，通过坐标导数表示大小变化。新的导数向量为$\frac{^{G}d}{dt}v$ 在G下的坐标为$[\frac{^{G}d}{dt}v]$ (in code DtG_v)，其可能被表示在E下DtG_v_E



## Spatial Vector相关

Drake的Spatial Vector使用Eigen矩阵表示



